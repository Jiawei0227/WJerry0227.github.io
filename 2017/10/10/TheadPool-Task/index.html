<!doctype html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Java,Python,Thread," />








  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.1.1" />






<meta name="description" content="In this Passage, we will talk about the ThreadPool for both Python and Java. We will see the basic usage of them but we will not talk about the detail of them.  1. Python concurrent.futuresWe will se">
<meta name="keywords" content="Java,Python,Thread">
<meta property="og:type" content="article">
<meta property="og:title" content="TheadPool Task">
<meta property="og:url" content="http://wjerry.top/2017/10/10/TheadPool-Task/index.html">
<meta property="og:site_name" content="Jiawei Wang&#39;s Blog">
<meta property="og:description" content="In this Passage, we will talk about the ThreadPool for both Python and Java. We will see the basic usage of them but we will not talk about the detail of them.  1. Python concurrent.futuresWe will se">
<meta property="og:updated_time" content="2017-11-07T13:20:24.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="TheadPool Task">
<meta name="twitter:description" content="In this Passage, we will talk about the ThreadPool for both Python and Java. We will see the basic usage of them but we will not talk about the detail of them.  1. Python concurrent.futuresWe will se">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://wjerry.top/2017/10/10/TheadPool-Task/"/>





  <title>TheadPool Task | Jiawei Wang's Blog</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jiawei Wang's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://wjerry.top/2017/10/10/TheadPool-Task/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jiawei Wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/11706812?v=3&u=d522fd4fec2c536038e4c4677008e3911ea8899b&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jiawei Wang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">TheadPool Task</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-10T21:14:49+08:00">
                2017-10-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Programing/" itemprop="url" rel="index">
                    <span itemprop="name">Programing</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/10/10/TheadPool-Task/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/10/10/TheadPool-Task/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/10/10/TheadPool-Task/" class="leancloud_visitors" data-flag-title="TheadPool Task">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>In this Passage, we will talk about the ThreadPool for both Python and Java. We will see the basic usage of them but we will not talk about the detail of them.</p>
</blockquote>
<h2 id="1-Python-concurrent-futures"><a href="#1-Python-concurrent-futures" class="headerlink" title="1. Python concurrent.futures"></a>1. Python concurrent.futures</h2><p>We will see an example directly used when I worked with.</p>
<a id="more"></a>
<h3 id="a-create-Job-py-for-jobs-in-your-ThreadPool"><a href="#a-create-Job-py-for-jobs-in-your-ThreadPool" class="headerlink" title="a. create Job.py for jobs in your ThreadPool"></a>a. create Job.py for jobs in your ThreadPool</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> traceback</div><div class="line"><span class="keyword">import</span> json</div><div class="line"><span class="keyword">import</span> re</div><div class="line"><span class="keyword">import</span> JIRAapi</div><div class="line"><span class="keyword">from</span> Logger <span class="keyword">import</span> logging</div><div class="line"><span class="keyword">import</span> xlwt</div><div class="line"><span class="keyword">import</span> SVNapi</div><div class="line"><span class="keyword">import</span> githubapi</div><div class="line"><span class="keyword">from</span> concurrent <span class="keyword">import</span> futures</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Job</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,project,projectSection,sheet)</span>:</span></div><div class="line">        self.i = <span class="number">1</span></div><div class="line">        self.counter_lock = threading.Lock()</div><div class="line">        self.project = project</div><div class="line">        self.projectSection = projectSection</div><div class="line">        self.sheet = sheet</div><div class="line">        self.futureset = set()</div><div class="line">        self.pool = futures.ThreadPoolExecutor()</div><div class="line">        self.pattern = re.compile(<span class="string">r'(EE|AYT|AS|ADO|AMP|JET|SEC|XAF|APS|ADR|AO|SAF|BIQ|BTS|CAL|CRM|CAP|CDP|CMSD|CR|CCL|CSS|CCD|CLD|CM|COKM|COSD|CO|PROJOPS|CORCA|COSR|UI|CMP|SL|CTM|CRF|XPI|CCT|DCF|ENGSERV|DEVIT|DBPERF|DAP|EGL|ECT|EDU|BUILD|DBREVIEW|ENGPROC|ESS|EAP|EN|FEDD|GRR|GE|TGM|HCPEXT|HMP|HMG|INT|IMP|IO|JAT|KB|KM|LANG|LRN|LESC|MOB|MTR|NCC|NGP|OBX|ONB|OWFP|PARTNEROPS|PTCH|PAY|PLT|PTK|PMT|PMR|PMU|TRVW|PDZ|PE|REC|PROV|AUT|RTO|RCM|RMK|RMKIT|RP|RPG|RPI|SFRE|RMDA|RPT|RNR|COPS|SAASOPS|SAS|MSS|SM|SRSD|SR|SHPT|SMT|SMB|CUB|SCO|SFT|SCM|STE|SML|SP|TCR|TFT|TD|TLS|UXN|VRP|VONE|API|WFP|WFA|WST|CALC)-[0-9]&#123;1,7&#125;'</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">processSection</span><span class="params">(self,section)</span>:</span></div><div class="line">        url = <span class="string">"&#123;&#125;/src/main/java/com/successfactors/&#123;&#125;"</span>.format(self.projectSection,section)</div><div class="line">        packageList = githubapi.githubContent(self.project,url)</div><div class="line">        self.iteration(packageList)</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            <span class="keyword">for</span> future <span class="keyword">in</span> futures.as_completed(self.futureset):</div><div class="line">                err = future.exception()</div><div class="line">                <span class="keyword">if</span> err <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</div><div class="line">                    <span class="keyword">raise</span> err</div><div class="line">                    exit()</div><div class="line">        <span class="keyword">except</span> KeyboardInterrupt:</div><div class="line">            print(<span class="string">"stopped by hand"</span>)</div><div class="line">        self.writeExcel(<span class="number">0</span>,<span class="number">1</span>,<span class="string">"CLASSPATH"</span>)</div><div class="line">        self.writeExcel(<span class="number">0</span>,<span class="number">2</span>,<span class="string">"COMMENT"</span>)</div><div class="line">        self.writeExcel(<span class="number">0</span>,<span class="number">3</span>,<span class="string">"TICKET"</span>)</div><div class="line">        self.writeExcel(<span class="number">0</span>,<span class="number">4</span>,<span class="string">"PROJECTNAME"</span>)</div><div class="line">        self.writeExcel(<span class="number">0</span>,<span class="number">5</span>,<span class="string">"PROJECTID"</span>)</div><div class="line">        self.writeExcel(<span class="number">0</span>,<span class="number">6</span>,<span class="string">"COMPONENTSNAME"</span>)</div><div class="line">        self.writeExcel(<span class="number">0</span>,<span class="number">7</span>,<span class="string">"COMPONENTSID"</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">processMyself</span><span class="params">(self)</span>:</span></div><div class="line">        url = <span class="string">"&#123;&#125;/src/main/java/com/successfactors"</span>.format(self.projectSection)</div><div class="line">        packageList = githubapi.githubContent(self.project,url)</div><div class="line">        self.iteration(packageList)</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            <span class="keyword">for</span> future <span class="keyword">in</span> futures.as_completed(self.futureset):</div><div class="line">                err = future.exception()</div><div class="line">                <span class="keyword">if</span> err <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</div><div class="line">                    <span class="keyword">raise</span> err</div><div class="line">                    exit()</div><div class="line">        <span class="keyword">except</span> KeyboardInterrupt:</div><div class="line">            print(<span class="string">"stopped by hand"</span>)</div><div class="line">        self.writeExcel(<span class="number">0</span>,<span class="number">1</span>,<span class="string">"CLASSPATH"</span>)</div><div class="line">        self.writeExcel(<span class="number">0</span>,<span class="number">2</span>,<span class="string">"COMMENT"</span>)</div><div class="line">        self.writeExcel(<span class="number">0</span>,<span class="number">3</span>,<span class="string">"TICKET"</span>)</div><div class="line">        self.writeExcel(<span class="number">0</span>,<span class="number">4</span>,<span class="string">"PROJECTNAME"</span>)</div><div class="line">        self.writeExcel(<span class="number">0</span>,<span class="number">5</span>,<span class="string">"PROJECTID"</span>)</div><div class="line">        self.writeExcel(<span class="number">0</span>,<span class="number">6</span>,<span class="string">"COMPONENTSNAME"</span>)</div><div class="line">        self.writeExcel(<span class="number">0</span>,<span class="number">7</span>,<span class="string">"COMPONENTSID"</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">iteration</span><span class="params">(self,packageList)</span>:</span></div><div class="line">        <span class="keyword">if</span> isinstance(packageList,dict):</div><div class="line">            <span class="keyword">return</span></div><div class="line">        <span class="keyword">for</span> package <span class="keyword">in</span> packageList:</div><div class="line">            path = package[<span class="string">"path"</span>]</div><div class="line"></div><div class="line">            <span class="keyword">if</span>(path.endswith(<span class="string">".java"</span>)):</div><div class="line">                logging.info(<span class="string">"[Start  INFO]"</span>+path + <span class="string">" in process"</span>)</div><div class="line">                future = self.pool.submit(self.processJava,path)</div><div class="line">                self.futureset.add(future)</div><div class="line">                <span class="keyword">continue</span></div><div class="line">            self.iteration(githubapi.githubContent(self.project,path))</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">writeExcel</span><span class="params">(self,row,column,data)</span>:</span></div><div class="line">        self.sheet.write(row,column,data)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">processJava</span><span class="params">(self,path)</span>:</span></div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            <span class="keyword">if</span> self.counter_lock.acquire():</div><div class="line">                n = self.i</div><div class="line">                self.i = self.i + <span class="number">1</span></div><div class="line">                self.counter_lock.release()</div><div class="line">            historyList = githubapi.githubHistory(self.project,path)</div><div class="line">            <span class="keyword">for</span> x <span class="keyword">in</span> range(len(historyList)<span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>):</div><div class="line">                history = historyList[x]</div><div class="line">                commitInfo = history[<span class="string">"commit"</span>][<span class="string">"message"</span>]</div><div class="line">                <span class="keyword">if</span> <span class="string">"based on"</span> <span class="keyword">in</span> commitInfo <span class="keyword">and</span> commitInfo.startswith(<span class="string">"Create modules"</span>):</div><div class="line">                    match = SVNapi.getTicket(path,self.project)</div><div class="line">                    <span class="keyword">if</span> match:</div><div class="line">                        commitInfo = match.string</div><div class="line">                        self.writeExcel(n, <span class="number">3</span> , match.group())</div><div class="line">                        jiraInfo = JIRAapi.getProjectandComponetByKEY(match.group())</div><div class="line">                        <span class="keyword">if</span> jiraInfo:</div><div class="line">                            self.writeExcel(n, <span class="number">4</span> , jiraInfo[<span class="string">"project"</span>][<span class="string">"name"</span>])</div><div class="line">                            self.writeExcel(n, <span class="number">5</span> , jiraInfo[<span class="string">"project"</span>][<span class="string">"id"</span>])</div><div class="line">                            componentNamestr = <span class="string">""</span></div><div class="line">                            componentIDstr = <span class="string">""</span></div><div class="line">                            <span class="keyword">for</span> component <span class="keyword">in</span> jiraInfo[<span class="string">"components"</span>]:</div><div class="line">                                componentNamestr = componentNamestr + component[<span class="string">"name"</span>]</div><div class="line">                                componentIDstr = componentIDstr + component[<span class="string">"id"</span>]</div><div class="line">                            self.writeExcel(n, <span class="number">6</span> , componentNamestr)</div><div class="line">                            self.writeExcel(n, <span class="number">7</span> , componentIDstr)</div><div class="line">                        <span class="keyword">else</span>:</div><div class="line">                            logging.warning(<span class="string">"[WARNING INFO] "</span> + path + <span class="string">" -------- COMMENT:"</span> + commitInfo)</div><div class="line">                            self.writeExcel(n, <span class="number">4</span> ,<span class="string">"INVALID ID"</span>)</div><div class="line">                        <span class="keyword">break</span></div><div class="line">                    <span class="keyword">else</span>:</div><div class="line">                        commitInfo = SVNapi.getFirstHistory(path,self.project)</div><div class="line"></div><div class="line">                match = re.search(self.pattern,commitInfo)</div><div class="line">                <span class="keyword">if</span> match:</div><div class="line">                    self.writeExcel(n, <span class="number">3</span> , match.group())</div><div class="line">                    jiraInfo = JIRAapi.getProjectandComponetByKEY(match.group())</div><div class="line">                    <span class="keyword">if</span> jiraInfo:</div><div class="line">                        self.writeExcel(n, <span class="number">4</span> , jiraInfo[<span class="string">"project"</span>][<span class="string">"name"</span>])</div><div class="line">                        self.writeExcel(n, <span class="number">5</span> , jiraInfo[<span class="string">"project"</span>][<span class="string">"id"</span>])</div><div class="line">                        componentNamestr = <span class="string">""</span></div><div class="line">                        componentIDstr = <span class="string">""</span></div><div class="line">                        <span class="keyword">for</span> component <span class="keyword">in</span> jiraInfo[<span class="string">"components"</span>]:</div><div class="line">                            componentNamestr = componentNamestr + component[<span class="string">"name"</span>]</div><div class="line">                            componentIDstr = componentIDstr + component[<span class="string">"id"</span>]</div><div class="line">                        self.writeExcel(n, <span class="number">6</span> , componentNamestr)</div><div class="line">                        self.writeExcel(n, <span class="number">7</span> , componentIDstr)</div><div class="line">                    <span class="keyword">else</span>:</div><div class="line">                        logging.warning(<span class="string">"[WARNING INFO] "</span> + path + <span class="string">" -------- COMMENT:"</span> + commitInfo)</div><div class="line">                        self.writeExcel(n, <span class="number">4</span> ,<span class="string">"INVALID ID"</span>)</div><div class="line">                    <span class="keyword">break</span></div><div class="line">                <span class="keyword">else</span>:</div><div class="line">                    <span class="keyword">continue</span></div><div class="line"></div><div class="line">            self.writeExcel(n, <span class="number">1</span> , path)</div><div class="line">            self.writeExcel(n, <span class="number">2</span>, commitInfo)</div><div class="line">            logging.info(<span class="string">"[Finish INFO] "</span> + path + <span class="string">" -------- COMMENT:"</span> + commitInfo)</div><div class="line">            <span class="keyword">if</span> <span class="keyword">not</span> match:</div><div class="line">                logging.info(<span class="string">"[NO MATCH] No jira ticket match on path"</span> + path)</div><div class="line">                self.writeExcel(n, <span class="number">3</span> , <span class="string">"NULL"</span>)</div><div class="line">        <span class="keyword">except</span> Exception, e:</div><div class="line">            logging.error(<span class="string">"[[[ERROR!!!!!!!!!!!!!!!!!!!!!!!! :"</span> + path + <span class="string">"]]]"</span> + <span class="string">"\n"</span> + traceback.format_exc())</div></pre></td></tr></table></figure>
<p>The logic of this code content is a bit complex, which we will not talk about too much on it.  But we noticed that we create a <strong>threading.Lock()</strong> in the construction of this class. This is a lock to ensure that when the ThreadPool execute. Different threads will not make change to the same variable at the same time.</p>
<h3 id="b-the-analysis-of-this-code"><a href="#b-the-analysis-of-this-code" class="headerlink" title="b. the analysis of this code :"></a>b. the analysis of this code :</h3><blockquote>
<p>self.counter_lock = threading.Lock()<br>self.futureset = set()<br>self.pool = futures.ThreadPoolExecutor()</p>
</blockquote>
<p>These three properties are the most important for the <strong>future</strong> package. And the variable <strong>futureset</strong> is used to store all the future return value when the thread begins to execute.</p>
<h3 id="c-examples-of-how-it-return"><a href="#c-examples-of-how-it-return" class="headerlink" title="c. examples of how it return :"></a>c. examples of how it return :</h3><p>When you need to run a threading pool</p>
<ol>
<li><p>create a threadpool</p>
<blockquote>
<p>self.pool = futures.ThreadPoolExecutor()</p>
</blockquote>
</li>
<li><p>write a function to tell the threadpool to execute which function</p>
<blockquote>
<p>def task(self, param1, param2): # Param1 and Param2 are defined by your function</p>
</blockquote>
</li>
<li><p>submit the function and collect the return value</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">future = self.pool.submit(self.task,param1, param2)</div><div class="line">self.futureset.add(future)</div></pre></td></tr></table></figure>
</li>
</ol>
<p>Noticed that the variable <strong>future</strong> will contain the function’s return value.</p>
<ol>
<li>get the sync task done<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span>:</div><div class="line">    <span class="keyword">for</span> future <span class="keyword">in</span> futures.as_completed(self.futureset):</div><div class="line">        err = future.exception()</div><div class="line">        <span class="keyword">if</span> err <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</div><div class="line">            <span class="keyword">raise</span> err</div><div class="line">            exit()</div><div class="line"><span class="keyword">except</span> KeyboardInterrupt:</div><div class="line">    print(<span class="string">"stopped by hand"</span>)</div></pre></td></tr></table></figure>
</li>
</ol>
<p>When we call futures.as_completed(self.futureset)<br>The program will stop and wait until all the tasks in the threadpool are done and return us the future value</p>
<ol>
<li>more info<br>For more info on python <strong>future</strong> package<br>This document will help:<br><a href="http://xiaorui.cc/2014/11/15/%E4%BD%BF%E7%94%A8python%E7%9A%84%E4%B8%8A%E5%B1%82%E5%B0%81%E8%A3%85%E5%B9%B6%E5%8F%91%E5%BA%93concurrent-futures%E5%AE%9E%E7%8E%B0%E5%BC%82%E6%AD%A5/" target="_blank" rel="external">http://xiaorui.cc/2014/11/15/%E4%BD%BF%E7%94%A8python%E7%9A%84%E4%B8%8A%E5%B1%82%E5%B0%81%E8%A3%85%E5%B9%B6%E5%8F%91%E5%BA%93concurrent-futures%E5%AE%9E%E7%8E%B0%E5%BC%82%E6%AD%A5/</a></li>
</ol>
<h2 id="Java-threadpool"><a href="#Java-threadpool" class="headerlink" title="Java threadpool"></a>Java threadpool</h2><p>In my program, I only used newCachedThreadPool.</p>
<blockquote>
<p>Creates a thread pool that creates new threads as needed, but will reuse previously constructed threads when they are available. These pools will typically improve the performance of programs that execute many short-lived asynchronous tasks. Calls to execute will reuse previously constructed threads if available. If no existing thread is available, a new thread will be created and added to the pool. Threads that have not been used for sixty seconds are terminated and removed from the cache. Thus, a pool that remains idle for long enough will not consume any resources. Note that pools with similar properties but different details (for example, timeout parameters) may be created using ThreadPoolExecutor constructors.</p>
</blockquote>
<p>This is like the most used pool.</p>
<h3 id="usage"><a href="#usage" class="headerlink" title="usage"></a>usage</h3><ol>
<li><p>Let’s take a look at a product method</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div></pre></td><td class="code"><pre><div class="line">   <span class="function"><span class="keyword">public</span> JiraInfoVO <span class="title">getJiraInfoMutl</span><span class="params">(String location)</span> </span>&#123;</div><div class="line">      ExecutorService cachedThreadPool = Executors.newCachedThreadPool();</div><div class="line"></div><div class="line">      JiraInfoVO jiraInfoVO = <span class="keyword">new</span> JiraInfoVO();</div><div class="line">      String projectName = location.split(<span class="string">"/"</span>)[<span class="number">2</span>];</div><div class="line">      String projectPath = location.substring(location.indexOf(location.split(<span class="string">"/"</span>)[<span class="number">3</span>]));</div><div class="line">      GitCommitGraphBean gitCommitBean = GithubGraphqlAPI.getClassHistoryComments(projectName, projectPath);</div><div class="line">      JsonObject countMapping = <span class="keyword">new</span> JsonObject();</div><div class="line">      List&lt;RelatedIssue&gt; relatedIssues = <span class="keyword">new</span> ArrayList&lt;RelatedIssue&gt;();</div><div class="line">      HashMap&lt;String, String&gt; componentMap = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</div><div class="line">      List&lt;IssueSearchBean&gt; issueSearchBeans = <span class="keyword">new</span> ArrayList&lt;IssueSearchBean&gt;();</div><div class="line">      List&lt;Future&lt;IssueSearchBean&gt;&gt; blockingQueue = <span class="keyword">new</span> ArrayList&lt;Future&lt;IssueSearchBean&gt;&gt;();</div><div class="line">      List&lt;String&gt; relatedTicketNumbers = <span class="keyword">new</span> ArrayList&lt;String&gt;();</div><div class="line"></div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">          <span class="keyword">for</span> (<span class="keyword">int</span> i =</div><div class="line">               gitCommitBean.getData().getRepository().getRef().getTarget().getHistory().getEdges().size() - <span class="number">1</span>;</div><div class="line">               i &gt;= <span class="number">0</span>; i--) &#123;</div><div class="line">              GitCommitGraphBean.DataEntity.RepositoryEntity.RefEntity.TargetEntity.HistoryEntity.EdgesEntity edgesEntity = gitCommitBean</div><div class="line">                  .getData().getRepository().getRef().getTarget().getHistory().getEdges().get(i);</div><div class="line">              String message = edgesEntity.getNode().getMessage();</div><div class="line">              Matcher m = pattern.matcher(message);</div><div class="line">              <span class="keyword">if</span> (m.find()) &#123;</div><div class="line">                  String ticketNumber = m.group();</div><div class="line"></div><div class="line">                  JiraGetTask jiraGetTask = <span class="keyword">new</span> JiraGetTask(ticketNumber);</div><div class="line"></div><div class="line">                  Future&lt;IssueSearchBean&gt; future = cachedThreadPool.submit(jiraGetTask);</div><div class="line">                  blockingQueue.add(future);</div><div class="line">                  logger.info(<span class="string">"Find ticketNumber"</span> + ticketNumber);</div><div class="line">              &#125;</div><div class="line">          &#125;</div><div class="line">          cachedThreadPool.shutdown();</div><div class="line">          logger.info(<span class="string">"Blockingqueue size"</span> + blockingQueue.size());</div><div class="line">          <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; blockingQueue.size(); i++) &#123;</div><div class="line">              issueSearchBeans.add(blockingQueue.get(i).get());</div><div class="line">          &#125;</div><div class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line"></div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; issueSearchBeans.size(); i++) &#123;</div><div class="line">          logger.info(<span class="string">"issue search size: "</span> + issueSearchBeans.size());</div><div class="line">          IssueSearchBean issueBean = issueSearchBeans.get(i);</div><div class="line">          <span class="comment">//Create related Issue</span></div><div class="line">          <span class="keyword">if</span> (relatedIssues.size() &lt;= <span class="number">5</span>) &#123;</div><div class="line">              <span class="keyword">if</span> (!relatedTicketNumbers.contains(issueBean.getKey())) &#123;</div><div class="line">                  relatedTicketNumbers.add(issueBean.getKey());</div><div class="line">                  RelatedIssue relatedIssue = <span class="keyword">new</span> RelatedIssue();</div><div class="line">                  relatedIssue.setKey(issueBean.getKey());</div><div class="line">                  relatedIssue.setSummary(issueBean.getFields().getSummary());</div><div class="line">                  relatedIssues.add(relatedIssue);</div><div class="line">              &#125;</div><div class="line">          &#125;</div><div class="line"></div><div class="line">          String project = issueBean.getFields().getProject().getName();</div><div class="line">          logger.info(<span class="string">"Find "</span> + project + <span class="string">" in "</span> + issueBean.getFields().getSummary());</div><div class="line">          <span class="keyword">if</span> (countMapping.has(project)) &#123;</div><div class="line">              countMapping.getAsJsonObject(project)</div><div class="line">                  .addProperty(<span class="string">"counting"</span>, countMapping.getAsJsonObject(project).get(<span class="string">"counting"</span>).getAsInt() + <span class="number">1</span>);</div><div class="line">              JsonObject components = countMapping.getAsJsonObject(project).getAsJsonObject(<span class="string">"components"</span>);</div><div class="line">              <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; issueBean.getFields().getComponents().size(); j++) &#123;</div><div class="line">                  IssueSearchBean.FieldsEntity.ComponentsEntity componentsEntity = issueBean.getFields()</div><div class="line">                      .getComponents()</div><div class="line">                      .get(j);</div><div class="line">                  componentMap.put(componentsEntity.getName(), componentsEntity.getId());</div><div class="line">                  <span class="keyword">if</span> (components.has(componentsEntity.getName() + <span class="string">""</span>)) &#123;</div><div class="line"></div><div class="line">                      components.addProperty(componentsEntity.getName() + <span class="string">""</span>,</div><div class="line">                          Integer.parseInt(components.get(componentsEntity.getName() + <span class="string">""</span>).toString()) + <span class="number">1</span>);</div><div class="line">                  &#125; <span class="keyword">else</span></div><div class="line">                      components.addProperty(componentsEntity.getName() + <span class="string">""</span>, <span class="number">1</span>);</div><div class="line">              &#125;</div><div class="line">          &#125; <span class="keyword">else</span> &#123;</div><div class="line">              JsonObject child = <span class="keyword">new</span> JsonObject();</div><div class="line">              child.addProperty(<span class="string">"counting"</span>, <span class="number">1</span>);</div><div class="line">              JsonObject components = <span class="keyword">new</span> JsonObject();</div><div class="line">              <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; issueBean.getFields().getComponents().size(); j++) &#123;</div><div class="line">                  IssueSearchBean.FieldsEntity.ComponentsEntity componentsEntity = issueBean.getFields()</div><div class="line">                      .getComponents()</div><div class="line">                      .get(j);</div><div class="line">                  components.addProperty(componentsEntity.getName() + <span class="string">""</span>, <span class="number">1</span>);</div><div class="line">              &#125;</div><div class="line">              child.add(<span class="string">"components"</span>, components);</div><div class="line">              countMapping.add(project, child);</div><div class="line">          &#125;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      String suggestProject = <span class="string">""</span>;</div><div class="line">      String suggestComponent = <span class="string">""</span>;</div><div class="line">      List&lt;TicketTypeVO&gt; ticketTypeVOS = <span class="keyword">new</span> ArrayList&lt;TicketTypeVO&gt;();</div><div class="line"></div><div class="line">      Iterator&lt;Map.Entry&lt;String, JsonElement&gt;&gt; iterator = countMapping.entrySet().iterator();</div><div class="line">      <span class="keyword">int</span> max = -<span class="number">1</span>;</div><div class="line">      <span class="keyword">while</span> (iterator.hasNext()) &#123;</div><div class="line"></div><div class="line">          TicketTypeVO ticketTypeVO = <span class="keyword">new</span> TicketTypeVO();</div><div class="line">          Map.Entry&lt;String, JsonElement&gt; re = iterator.next();</div><div class="line">          <span class="keyword">int</span> counting = Integer.parseInt(re.getValue().getAsJsonObject().get(<span class="string">"counting"</span>).toString());</div><div class="line"></div><div class="line">          ticketTypeVO.setCount(counting + <span class="string">""</span>);</div><div class="line">          ticketTypeVO.setName(re.getKey());</div><div class="line">          ArrayList&lt;TicketComponentVO&gt; ticketComponentVOS = <span class="keyword">new</span> ArrayList&lt;TicketComponentVO&gt;();</div><div class="line"></div><div class="line">          Iterator&lt;Map.Entry&lt;String, JsonElement&gt;&gt; componentIterator = countMapping.getAsJsonObject(re.getKey())</div><div class="line">              .getAsJsonObject(<span class="string">"components"</span>).entrySet().iterator();</div><div class="line">          <span class="keyword">while</span> (componentIterator.hasNext()) &#123;</div><div class="line">              Map.Entry&lt;String, JsonElement&gt; comre = componentIterator.next();</div><div class="line">              <span class="keyword">int</span> comcounting = Integer.parseInt(comre.getValue().toString());</div><div class="line">              TicketComponentVO ticketComponentVO = <span class="keyword">new</span> TicketComponentVO();</div><div class="line">              ticketComponentVO.setComponentName(comre.getKey());</div><div class="line">              ticketComponentVO.setCount(comcounting + <span class="string">""</span>);</div><div class="line"></div><div class="line">              ticketComponentVOS.add(ticketComponentVO);</div><div class="line">          &#125;</div><div class="line">          ticketTypeVO.setTicketComponentVOS(ticketComponentVOS);</div><div class="line"></div><div class="line">          ticketTypeVOS.add(ticketTypeVO);</div><div class="line"></div><div class="line">          <span class="keyword">if</span> (counting &gt; max) &#123;</div><div class="line">              max = counting;</div><div class="line">              suggestProject = re.getKey();</div><div class="line">          &#125;</div><div class="line">      &#125;</div><div class="line">      Iterator&lt;Map.Entry&lt;String, JsonElement&gt;&gt; componentIterator = countMapping.getAsJsonObject(suggestProject)</div><div class="line">          .getAsJsonObject(<span class="string">"components"</span>).entrySet().iterator();</div><div class="line">      max = -<span class="number">1</span>;</div><div class="line">      <span class="keyword">while</span> (componentIterator.hasNext()) &#123;</div><div class="line">          Map.Entry&lt;String, JsonElement&gt; re = componentIterator.next();</div><div class="line">          <span class="keyword">int</span> counting = Integer.parseInt(re.getValue().toString());</div><div class="line">          <span class="keyword">if</span> (counting &gt; max) &#123;</div><div class="line">              max = counting;</div><div class="line">              suggestComponent = re.getKey();</div><div class="line">          &#125;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      String componentId = componentMap.get(suggestComponent);</div><div class="line">      ComponentBean componentBean = JiraRESTAPI.getTeamOwnerByComponentId(componentId);</div><div class="line">      String leader = componentBean.getLead().getDisplayName();</div><div class="line">      logger.info(<span class="string">"Get countMap"</span> + <span class="keyword">new</span> Gson().toJson(countMapping));</div><div class="line"></div><div class="line">      jiraInfoVO.setHistory(ticketTypeVOS);</div><div class="line">      jiraInfoVO.setComponent(suggestComponent);</div><div class="line">      jiraInfoVO.setProject(suggestProject);</div><div class="line">      jiraInfoVO.setRelatedIssue(relatedIssues);</div><div class="line">      jiraInfoVO.setTeamOwner(leader);</div><div class="line">      <span class="keyword">return</span> jiraInfoVO;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>Analysis the code<br>We create a threadingpool at first</p>
<blockquote>
<p>ExecutorService cachedThreadPool = Executors.newCachedThreadPool();</p>
</blockquote>
</li>
</ol>
<p>and then also create future objects as well</p>
<blockquote>
<p>List<future<issuesearchbean>&gt; blockingQueue = new ArrayList<future<issuesearchbean>&gt;();</future<issuesearchbean></future<issuesearchbean></p>
</blockquote>
<p>excute the task<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Future&lt;IssueSearchBean&gt; future = cachedThreadPool.submit(jiraGetTask);</div><div class="line">blockingQueue.add(future);</div></pre></td></tr></table></figure></p>
<p>after insert all tasks we need to do.</p>
<blockquote>
<p>cachedThreadPool.shutdown();</p>
</blockquote>
<p>This commend will wait until all the task is done.<br>The result value can be get from the commend:</p>
<blockquote>
<p>blockingQueue.get(i).get()</p>
</blockquote>
<h2 id="This-is-how-the-java-and-python-threadpool-execute-in-real-product-environment"><a href="#This-is-how-the-java-and-python-threadpool-execute-in-real-product-environment" class="headerlink" title="This is how the java and python threadpool execute in real product environment."></a>This is how the java and python threadpool execute in real product environment.</h2>
      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Java/" rel="tag"># Java</a>
          
            <a href="/tags/Python/" rel="tag"># Python</a>
          
            <a href="/tags/Thread/" rel="tag"># Thread</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/08/21/Wechat-Auto-Reply-Program/" rel="next" title="Wechat Auto Reply Program">
                <i class="fa fa-chevron-left"></i> Wechat Auto Reply Program
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/10/25/GitHub-API/" rel="prev" title="GitHub API">
                GitHub API <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://avatars0.githubusercontent.com/u/11706812?v=3&u=d522fd4fec2c536038e4c4677008e3911ea8899b&s=400"
               alt="Jiawei Wang" />
          <p class="site-author-name" itemprop="name">Jiawei Wang</p>
           
              <p class="site-description motion-element" itemprop="description">How you took the sourest lemon that life has to offer and turned it into something resembling lemonade.</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">18</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/WJerry0227" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Python-concurrent-futures"><span class="nav-number">1.</span> <span class="nav-text">1. Python concurrent.futures</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#a-create-Job-py-for-jobs-in-your-ThreadPool"><span class="nav-number">1.1.</span> <span class="nav-text">a. create Job.py for jobs in your ThreadPool</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#b-the-analysis-of-this-code"><span class="nav-number">1.2.</span> <span class="nav-text">b. the analysis of this code :</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#c-examples-of-how-it-return"><span class="nav-number">1.3.</span> <span class="nav-text">c. examples of how it return :</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Java-threadpool"><span class="nav-number">2.</span> <span class="nav-text">Java threadpool</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#usage"><span class="nav-number">2.1.</span> <span class="nav-text">usage</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#This-is-how-the-java-and-python-threadpool-execute-in-real-product-environment"><span class="nav-number">3.</span> <span class="nav-text">This is how the java and python threadpool execute in real product environment.</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jiawei Wang</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  

    
      <script id="dsq-count-scr" src="https://wjerry0227.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://wjerry.top/2017/10/10/TheadPool-Task/';
          this.page.identifier = '2017/10/10/TheadPool-Task/';
          this.page.title = 'TheadPool Task';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://wjerry0227.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  





  








  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("rEOTF7z0J4uYXk94ycQCJmk1-gzGzoHsz", "1PM51Ew3mh2P1E6UaPGEpMJ3");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

  

  



</body>
</html>
